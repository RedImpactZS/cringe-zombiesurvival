local sleekColors = {
	{name = "Chestnut Rose", clr = Color(210, 77, 87)},
{name = "Pomegranate", clr = Color(242, 38, 19)},
{name = "Thunderbird", clr = Color(217, 30, 24)},
{name = "Old Brick", clr = Color(150, 40, 27)},
{name = "Flamingo", clr = Color(239, 72, 54)},
{name = "Valencia", clr = Color(214, 69, 65)},
{name = "Tall Poppy", clr = Color(192, 57, 43)},
{name = "Monza", clr = Color(207, 0, 15)},
{name = "Cinnabar", clr = Color(231, 76, 60)},
{name = "Razzmatazz", clr = Color(219, 10, 91)},
{name = "Sunset Orange", clr = Color(246, 71, 71)},
{name = "Wax Flower", clr = Color(241, 169, 160)},
{name = "Cabaret", clr = Color(210, 82, 127)},
{name = "New York Pink", clr = Color(224, 130, 131)},
{name = "Radical Red", clr = Color(246, 36, 89)},
{name = "Sunglo", clr = Color(226, 106, 106)},
{name = "Snuff", clr = Color(220, 198, 224)},
{name = "rebeccapurple", clr = Color(102, 51, 153)},
{name = "Honey Flower", clr = Color(103, 65, 114)},
{name = "Wistful", clr = Color(174, 168, 211)},
{name = "Plum", clr = Color(145, 61, 136)},
{name = "Seance", clr = Color(154, 18, 179)},
{name = "Medium Purple", clr = Color(191, 85, 236)},
{name = "Light Wisteria", clr = Color(190, 144, 212)},
{name = "Studio", clr = Color(142, 68, 173)},
{name = "Wisteria", clr = Color(155, 89, 182)},
{name = "San Marino", clr = Color(68,108,179)},
{name = "Alice Blue", clr = Color(228, 241, 254)},
{name = "Royal Blue", clr = Color(65, 131, 215)},
{name = "Picton Blue", clr = Color(89, 171, 227)},
{name = "Spray", clr = Color(129, 207, 224)},
{name = "Shakespeare", clr = Color(82, 179, 217)},
{name = "Humming Bird", clr = Color(197, 239, 247)},
{name = "Picton Blue", clr = Color(34, 167, 240)},
{name = "Curious Blue", clr = Color(52, 152, 219)},
{name = "Madison", clr = Color(44, 62, 80)},
{name = "Dodger Blue", clr = Color(25, 181, 254)},
{name = "Ming", clr = Color(51, 110, 123)},
{name = "Ebony Clay", clr = Color(34, 49, 63)},
{name = "Malibu", clr = Color(107, 185, 240)},
{name = "Summer Sky", clr = Color(30, 139, 195)},
{name = "Chambray", clr = Color(58, 83, 155)},
{name = "Pickled Bluewood", clr = Color(52, 73, 94)},
{name = "Hoki", clr = Color(103, 128, 159)},
{name = "Jelly Bean", clr = Color(37, 116, 169)},
{name = "Jacksons Purple", clr = Color(31, 58, 147)},
{name = "Jordy Blue", clr = Color(137, 196, 244)},
{name = "Steel Blue", clr = Color(75, 119, 190)},
{name = "Fountain Blue", clr = Color(92, 151, 191)},
{name = "Medium Turquoise", clr = Color(78,205,196)},
{name = "Aqua Island", clr = Color(162, 222, 208)},
{name = "Gossip", clr = Color(135, 211, 124)},
{name = "Dark Sea Green", clr = Color(144, 198, 149)},
{name = "Eucalyptus", clr = Color(38, 166, 91)},
{name = "Caribbean Green", clr = Color(3, 201, 169)},
{name = "Silver Tree", clr = Color(104, 195, 163)},
{name = "Downy", clr = Color(101, 198, 187)},
{name = "Mountain Meadow", clr = Color(27, 188, 155)},
{name = "Light Sea Green", clr = Color(27, 163, 156)},
{name = "Medium Aquamarine", clr = Color(102, 204, 153)},
{name = "Turquoise", clr = Color(54, 215, 183)},
{name = "Madang", clr = Color(200, 247, 197)},
{name = "Riptide", clr = Color(134, 226, 213)},
{name = "Shamrock", clr = Color(46, 204, 113)},
{name = "Niagara", clr = Color(22, 160, 133)},
{name = "Emerald", clr = Color(63, 195, 128)},
{name = "Green Haze", clr = Color(1, 152, 117)},
{name = "Free Speech Aquamarine", clr = Color(3, 166, 120)},
{name = "Ocean Green", clr = Color(77, 175, 124)},
{name = "Niagara 1", clr = Color(42, 187, 155)},
{name = "Jade", clr = Color(0, 177, 106)},
{name = "Salem", clr = Color(30, 130, 76)},
{name = "Observatory", clr = Color(4, 147, 114)},
{name = "Jungle Green", clr = Color(38, 194, 129)},
{name = "Cape Honey", clr = Color(253, 227, 167)},
{name = "California", clr = Color(248, 148, 6)},
{name = "Fire Bush", clr = Color(235, 149, 50)},
{name = "Tahiti Gold", clr = Color(232, 126, 4)},
{name = "Casablanca", clr = Color(244, 179, 80)},
{name = "Crusta", clr = Color(242, 120, 75)},
{name = "Sea Buckthorn", clr = Color(235, 151, 78)},
{name = "Lightning Yellow", clr = Color(245, 171, 53)},
{name = "Burnt Orange", clr = Color(211, 84, 0)},
{name = "Buttercup", clr = Color(243, 156, 18)},
{name = "Ecstasy", clr = Color(249, 105, 14)},
{name = "Sandstorm", clr = Color(249, 191, 59)},
{name = "Jaffa", clr = Color(242, 121, 53)},
{name = "Zest", clr = Color(230, 126, 34)},
{name = "White Smoke", clr = Color(236,236,236)},
{name = "Lynch", clr = Color(108, 122, 137)},
{name = "Pumice", clr = Color(210, 215, 211)},
{name = "Gallery", clr = Color(238, 238, 238)},
{name = "Silver Sand", clr = Color(189, 195, 199)},
{name = "Porcelain", clr = Color(236, 240, 241)},
{name = "Cascade", clr = Color(149, 165, 166)},
{name = "Iron", clr = Color(218, 223, 225)},
{name = "Edward", clr = Color(171, 183, 183)},
{name = "Cararra", clr = Color(242, 241, 239)},
}

local links = {
	{name = "Half Life 2 Sounds", link = "https://maurits.tv/data/garrysmod/wiki/wiki.garrysmod.com/index8f77.html"},
	{name = "GMod Wiki", link = "http://wiki.garrysmod.com/page/Main_Page"},
	{name = "GMod Source", link = "https://github.com/garrynewman/garrysmod/"},
	{name = "DarkRP Wiki", link = "http://wiki.darkrp.com/index.php/Main_Page"},
	{name = "TTT Hooks", link = "http://ttt.badking.net/guides/hooks"},
	{name = "BASS Error Codes", link = "http://www.un4seen.com/doc/#bass/BASS_ErrorGetCode.html"},
	{name = "Lua 5.1 Reference", link = "http://www.lua.org/manual/5.1/"},
	{name = "Easing Equations", link = "https://github.com/EmmanuelOga/easing/blob/master/examples/simple/easing.lua"}
}

local buzzwords = {
	"Modern", "Sleek", "Flat", "Custom", "Customizable", "Unique", "Premium",
	"Advanced", "Enhanced", "Blur", "Ultimate", "Simple", "Polished", "Real",
	"Crisp"
}

local function BuzzwordGen()
	local fr = vgui.Create("DFrame")
	fr:SetSize(300, 100)
	fr:Center()
	fr:SetTitle("Buzzword Generator")

	local comps = {}
	for _,bw in pairs(buzzwords) do
		local comp = vgui.Create("DTextEntry", fr)
		comp:SetDrawBackground(false)
		comp:SetText(bw)
		comp:SetFont("DermaLarge")
		comp:SetWide(175)
		comp:SetDisabled(true)
		comp:SetAllowNonAsciiCharacters(false)
		comps[#comps+1] = comp
	end

	local function easeOut(t, b, c, d)
		return c * ( -math.pow( 2, -10 * t/d ) + 1 ) + b;
	end

	local start = CurTime()
	local time = 3 + math.random()
	local e = 0
	fr.Think = function()
		local speed = 1 - easeOut(CurTime()-start, 0, 1, time)
		if speed < 0.001 then
			surface.PlaySound("items/suitchargeok1.wav")
			fr.Think = nil
			return
		end
		e = e + speed * 500
		local w = 175
		for i,c in pairs(comps) do
			local x = -w + ((e + i*w) % (fr:GetWide()+(#comps*w)))
			c:SetPos(x, 50)
		end
	end

	fr:MakePopup()
end
concommand.Add("gace-buzzwordgen", BuzzwordGen)

local function SoundTester()
	local fr = vgui.Create("DFrame")
	fr:SetSize(400, 350)
	fr:Center()
	fr:SetTitle("Sound Tester")

	local listc = fr:Add("Panel")
	listc:Dock(FILL)
	local list = listc:Add("Panel")
	list:Dock(FILL)
	local listscr = listc:Add("DVScrollBar")
	listscr:Dock(RIGHT)

	local itemHeight = 25

	function list:AddLine(path)
		self.Lines = self.Lines or {}
		self.Lines[#self.Lines + 1] = path
	end
	function list:PerformLayout()
		local lineCount = (self.VisibleLines and #self.VisibleLines) or 0
		local tallness = lineCount * itemHeight

		listscr:SetUp(listc:GetTall(), tallness)
		listscr:SetScroll(0) -- reset scroll
	end
	function list:GetPosItemIndex(x, y)
		if x < 0 or x > self:GetWide() then return end

		local firstItemIndex = 1 + math.floor(-listscr:GetOffset() / itemHeight)
		local firstItemOffset = -(listscr:GetOffset() % itemHeight)
		
		local yOffset = y - firstItemOffset
		return firstItemIndex + math.floor(yOffset / itemHeight)
	end
	function list:Paint(w, h)
		local firstItemIndex = 1 + math.floor(-listscr:GetOffset() / itemHeight)
		local firstItemOffset = -(listscr:GetOffset() % itemHeight)

		local hoveredItem = self:GetPosItemIndex(self:CursorPos())

		for i = firstItemIndex, firstItemIndex + math.ceil(self:GetTall() / itemHeight) do
			local item = self.VisibleLines[i]
			if not item then break end

			local y = firstItemOffset + (i - firstItemIndex) * itemHeight
			
			if hoveredItem == i then
				surface.SetDrawColor(200, 200, 200)
			else
				surface.SetDrawColor(127, 127, 127)
			end
			surface.DrawRect(0, y, w, itemHeight)

			surface.SetDrawColor(0, 0, 0)
			surface.DrawOutlinedRect(0, y, w, itemHeight)

			draw.SimpleText(item, "DermaDefault", 10, y + 5)
		end

		--draw.SimpleText(tostring(listscr:GetOffset()), "DermaDefault", 10, 10)
	end
	function list:OnMouseWheeled( dlta )
		return listscr:OnMouseWheeled( dlta )
	end
	function list:SetFilterAndUpdate(filter)
		self.VisibleLines = {}
		for _,line in pairs(self.Lines) do
			if not filter or filter(line) then
				self.VisibleLines[#self.VisibleLines + 1] = line
			end
		end
		self:InvalidateLayout()
	end
	function list:OnMouseReleased()
		local hoveredItemIndex = self:GetPosItemIndex(self:CursorPos())
		local hoveredItem = self.VisibleLines[hoveredItemIndex]
		if hoveredItem then
			self:OnRowSelected(hoveredItem)
		end
	end
	function list:OnRowSelected(row)
		RunConsoleCommand("stopsound")

		timer.Simple(0.2, function()
			local path = row:match("%[[^%]]*%] (.*)") or row
			surface.PlaySound(path)
		end)
	end

	local pathPrefixes = {}

	local function AddSoundFolder(f, path, depth)
		local fils, fols = file.Find("sound/" .. f .. "*", path)

		for _,fil in pairs(fils) do
			local fpath = f .. fil

			local prefix = pathPrefixes[path]
			if prefix then
				fpath = string.format("[%s] %s", prefix, fpath)
			end

			list:AddLine(fpath)
		end

		for _,fol in pairs(fols) do
			AddSoundFolder(f .. fol .. "/", path, (depth or 0) + 1)
		end
	end

	AddSoundFolder("", "WORKSHOP")
	AddSoundFolder("", "THIRDPARTY")
	AddSoundFolder("", "MOD")

	for _,game in pairs(engine.GetGames()) do
		if game.mounted then
			pathPrefixes[game.folder] = game.folder
			AddSoundFolder("", game.folder)
		end
	end

	print("sound file count: ", #list.Lines)

	list:SetFilterAndUpdate()

	local buttons = fr:Add("DPanel")
	buttons:Dock(TOP)

	local searchbar = buttons:Add("DTextEntry")
	searchbar:Dock(FILL)
	local op = searchbar.Paint
	local icon_mag = Material("icon16/magnifier.png")
	searchbar.Paint = function(pself, w, h)
		op(pself, w, h)

		surface.SetDrawColor(255, 255, 255, 255)
		surface.SetMaterial(icon_mag)
		surface.DrawTexturedRect(w-18, 2, 16, 16)
	end
	searchbar.OnTextChanged = function()
		local sblow = searchbar:GetText():lower()
		timer.Create("GAceSoundTesterSearch", 0.2, 1, function()
			if not IsValid(searchbar) then return end
			list:SetFilterAndUpdate(function(v) return v:lower():find(sblow, _, true) end)
		end)
	end
	searchbar:RequestFocus()

	fr:MakePopup()
end
concommand.Add("gace-soundtester", SoundTester)

gace.AddHook("AddActionBarComponents", "ActionBar_SnippetCommand", function(comps)
	comps:AddCategory("Resources", Color(51, 110, 123), 75)
	comps:AddComponent {
		text = "Resources",
		width = 100,
		fn = function(comp)
			local menu = DermaMenu()

			local csubmenu, csmpnl = menu:AddSubMenu("Sleek Colors", function() end)
			csmpnl:SetIcon("icon16/color_wheel.png")
			for _,t in pairs(sleekColors) do
				local opt = csubmenu:AddOption(t.name, function() SetClipboardText(string.format("Color(%d, %d, %d)", t.clr.r, t.clr.g, t.clr.b)) end)
				opt.PaintOver = function(_, w, h)
					surface.SetDrawColor(t.clr)
					surface.DrawRect(2, 2, h-4, h-4)
				end
			end

			menu:AddOption("Icons", function()
				local fr = vgui.Create("DFrame")
				fr:SetSize(400, 300)
				fr:Center()
				fr.Paint = function(_, w, h)
					surface.SetDrawColor(255, 255, 255)
					surface.DrawRect(0, 0, w, h)
				end

				local scr = fr:Add("DScrollPanel")
				scr:Dock(FILL)

				local grid = scr:Add("DGrid")
				grid:SetColWide(18)
				grid:SetRowHeight(18)
				grid:SetCols((400 - 20) / 18)

				for _,t in pairs(file.Find("materials/icon16/*.png", "GAME")) do
					local img = vgui.Create("DImageButton")
					img:SetSize(16, 16)
					img:SetMaterial("icon16/" .. t)
					img:SetTooltip("icon16/" .. t)
					grid:AddItem(img)

					img.DoClick = function()
						SetClipboardText("icon16/" .. t)
						fr:Close()
					end
				end

				fr:MakePopup()
			end):SetIcon("icon16/flag_blue.png")

			local csubmenu, csmpnl = menu:AddSubMenu("Links", function() end)
			csmpnl:SetIcon("icon16/link.png")
			for _,t in pairs(links) do
				local opt = csubmenu:AddOption(t.name, function() gui.OpenURL(t.link) end)
			end

			menu:AddOption("Buzzword Generator", BuzzwordGen):SetIcon("icon16/coins.png")

			menu:AddOption("Sound Tester", SoundTester):SetIcon("icon16/sound.png")

			menu:Open()
		end
	}
	comps:AddCategoryEnd()
end)
